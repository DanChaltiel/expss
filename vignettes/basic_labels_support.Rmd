---
title: "Basic SPSS labels support in R"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Basic SPSS labels support in R}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

It is possible to add support for SPSS value labels for such R functions as `table`, `xtabs`, `by` and so on by replacing base R function `factor` by function (`expss::factor`) that aware about variables with labels. This function will use value labels as factor levels. So all R functions that use internally `factor` and `as.factor` will take advantages of value labels. For variables without labels original `factor` will be called.
It is not good practice to interfere with internal structure of packages so use this hack ON YOUR OWN RISK AND WITHOUT ANY WARRANTY. Hack will be active until the end of your R session.  If you plan to use it on constant bases you can put code below in your `{R_home}/etc/Rprofile.site` file. Then it will be executed automatically at the beginning of the each session.


```{r, eval = FALSE}

# hack begin
library(expss)

# replace `factor`
unlockBinding("factor", as.environment("package:base"))
assignInNamespace("factor", expss::factor, ns="base", envir=as.environment("package:base"))
assign("factor", expss::factor, as.environment("package:base"))
lockBinding("factor", as.environment("package:base"))

# replace `as.factor`
unlockBinding("as.factor", as.environment("package:base"))
assignInNamespace("as.factor", expss::as.factor, ns="base", envir=as.environment("package:base"))
assign("as.factor", expss::as.factor, as.environment("package:base"))
lockBinding("as.factor", as.environment("package:base"))


# replace `ordered`
unlockBinding("ordered", as.environment("package:base"))
assignInNamespace("ordered", expss::ordered, ns="base", envir=as.environment("package:base"))
assign("ordered", expss::ordered, as.environment("package:base"))
lockBinding("ordered", as.environment("package:base"))

# replace `as.ordered`
unlockBinding("as.ordered", as.environment("package:base"))
assignInNamespace("as.ordered", expss::as.ordered, ns="base", envir=as.environment("package:base"))
assign("as.ordered", expss::as.ordered, as.environment("package:base"))
lockBinding("as.ordered", as.environment("package:base"))
# end of hack

```

Several examples:

```{r, eval = FALSE}
data(mtcars)

# apply value labels
mtcars = within(mtcars,{
    var_lab(am) = "Transmission"
    val_lab(am) = c("Automatic" = 0, "Manual" = 1)
    var_lab(vs) = "Engine"
    val_lab(vs) = c("V-engine" = 0, "Straight engine" = 1) 
})

# we can use usual operations on numeric variables

mean(mtcars$am); mean(mtcars$vs)

# however, table
with(mtcars, table(am,vs))

# if we don't need variable label
with(mtcars, table(unvr(am),unvr(vs)))

# tapply

with(mtcars,tapply(mpg,am, FUN=mean))

# plot
boxplot(mpg ~ am, data = mtcars)

# if we don't need labels
boxplot(mpg ~ unlab(am), data = mtcars)

```

